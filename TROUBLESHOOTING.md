# 故障排查指南

## 问题：设置中找不到 S3 配置选项

### 解决方案

已修复！问题是 `manifest.json` 中缺少偏好设置注册。现在已经添加了正确的配置。

### 安装步骤（重要）

1. **卸载旧版本**（如果已安装）
   - 打开 Zotero
   - 工具 -> 插件
   - 找到旧版本的插件，点击删除
   - 重启 Zotero

2. **安装新版本**
   - 重新构建插件：`npm run build`
   - 工具 -> 插件 -> 齿轮图标 -> 从文件安装插件
   - 选择 `.scaffold/build/zotero-s-3-sync.xpi`
   - 重启 Zotero

3. **查看设置**
   - 编辑 -> 设置（或首选项）
   - 在左侧列表中应该能看到 "S3 同步" 选项
   - 点击后右侧会显示所有 S3 配置项

### 如果还是看不到设置

1. **检查插件是否已启用**

   ```
   工具 -> 插件 -> 确认 "Zotero S3 Sync" 已启用
   ```

2. **查看错误日志**

   ```
   帮助 -> 调试输出日志 -> 查看输出
   ```

   查找与插件相关的错误信息

3. **完全重启 Zotero**
   - 关闭所有 Zotero 窗口
   - 确保 Zotero 进程已完全退出（检查任务管理器）
   - 重新启动 Zotero

4. **清除缓存（极端情况）**
   - 关闭 Zotero
   - 找到 Zotero 数据目录（帮助 -> 关于 Zotero -> 显示数据目录）
   - 删除 `translators` 和 `styles` 文件夹中的缓存文件
   - 重启 Zotero

## 其他常见问题

### 1. 插件无法加载

**症状**: 安装后插件列表中看不到插件

**解决方案**:

- 确保下载的是正确的 `.xpi` 文件
- 确保 Zotero 版本是 7.0 或更高
- 检查 Zotero 错误日志

### 2. 同步按钮找不到

**症状**: 工具菜单中没有"同步到 S3"选项

**解决方案**:

- 确认插件已正确安装并启用
- 重启 Zotero
- 检查是否有 JavaScript 错误（帮助 -> 调试输出日志）

### 3. 连接测试失败

**症状**: 点击"测试连接"按钮后显示连接失败

**可能原因及解决**:

- **端点 URL 错误**: 确保格式正确，例如 `https://s3.amazonaws.com`
- **区域不匹配**: 确认区域代码正确，例如 `us-east-1`
- **密钥错误**: 检查 Access Key 和 Secret Key 是否正确
- **网络问题**: 确认可以访问 S3 服务
- **存储桶不存在**: 先在 S3 控制台创建存储桶
- **权限不足**: 确保密钥有访问该存储桶的权限

### 4. 上传失败

**症状**: 同步时显示错误或上传失败

**解决方案**:

- 检查网络连接
- 确认 S3 存储桶有足够空间
- 检查文件权限
- 查看调试日志获取详细错误信息

### 5. 找不到附件

**症状**: 插件显示没有附件需要同步

**解决方案**:

- 确认 Zotero 库中有附件文件（PDF、文档等）
- 确保附件已下载到本地（不是链接型附件）
- 检查附件文件是否存在于本地文件系统

## 调试技巧

### 启用详细日志

1. 帮助 -> 调试输出日志
2. 勾选 "启用"
3. 选择 "查看输出"
4. 执行出错的操作
5. 查看日志中的错误信息

### 查看插件状态

在 Zotero 的浏览器控制台中执行：

```javascript
// 检查插件是否加载
Zotero.S3Sync;

// 查看插件配置
Zotero.Prefs.get("extensions.zotero.s3sync.s3.endpoint");

// 测试连接
await Zotero.S3Sync.data.syncManager.s3Manager.testConnection();
```

## 获取帮助

如果以上方法都无法解决问题：

1. 收集以下信息：
   - Zotero 版本
   - 插件版本
   - 操作系统
   - 详细的错误信息或日志
   - 重现问题的步骤

2. 提交 Issue 到 GitHub 仓库

## 修复内容记录

### 版本 0.1.0 修复

- ✅ 添加了 `manifest.json` 中的 `preferences` 配置
- ✅ 更新了本地化字符串
- ✅ 确保偏好设置面板正确注册
